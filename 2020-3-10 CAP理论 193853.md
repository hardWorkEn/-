# CAP理论

+ **C 一致性**：数据在分布式环境下的多个副本之间能否保持一致性，这里的一致性指的是强一致性
+ **A 可用性**：分布式系统一直处于可用状态，对于请求总是能在有限的时间内返回结果
+ **P 分区容错性**：除非整个网络故障，分布式系统在任何网络或者单点故障时，仍能对外提供满足一致性和可用性的服务

|   AC   | 将数据和服务放在一个节点上，避免因网络引起的负面影响， 充分保障系统的可用性和一致性，但放弃P意味着放弃了系统的可扩展性 |
| :----: | ------------------------------------------------------------ |
| **PC** | **当节点故障或者网络故障时，受到影响的服务需要等待一定的时间，因此在等待的时间里，系统无法对外提供正常的服务，是不可用的** |
| **AP** | **系统无法保证实时一致性，但是承诺会最终一致性**             |

# BASE理论

+ **Basically Avaliable 基本可用：当分布式系统出现不可预见的错误时，允许损失部分可用性，保证系统的基本可用，体现在时间上的损失和功能上的损失**
+ **Soft state 软状态：允许系统中的数据存在中间状态，既系统的不同节点的数据副本之间的数据同步存在延时，并认为这种延时不会影响系统可用性**
+ **Eventually consistent 最终一致性：所有的数据在经过一段时间的数据同步后，最终能够达到一个一致的状态**

# 分布式一致性算法

常见分布式一致性算法：2P，3P，paxos，zab算法

| 序号 |   算法    |                             说明                             |
| :--: | :-------: | :----------------------------------------------------------: |
|  1   |   2p/3p   | 2P两阶段提交，数据库分布式事务经常使用的一种分布式算法，算法简单，但有出现阻塞，数据在某情况不一致的问题。3P对2P进行了完善，完善了阻塞以及可用性 |
|  2   | paxos算法 | 分布式一致性算法，也分两个阶段，遵循少数服从多数的原则，并不需要所有参与者都同意 |
|  3   |    zab    |           是zookeeper解决分布式一致性所使用的算法            |

# 会话

客户端与服务端的一次会话连接，本质是TCP长连接，通过会话可以进行心跳检测和数据传输。

# zookeeper节点状态属性

| 序号 |      属性       | 数据结构 |                             描述                             |
| :--: | :-------------: | :------: | :----------------------------------------------------------: |
|  1   |      czxid      |   long   |                      节点被创建的zxid值                      |
|  2   |      mzxid      |   long   |                      节点被修改的zxid值                      |
|  3   |      pzxid      |   long   |                子节点最后一次被修改时的事务ID                |
|  4   |      ctime      |   long   |                        节点被创建时间                        |
|  5   |      mtime      |   long   |                     节点最后一次修改时间                     |
|  6   |     version     |   long   |                      节点被修改的版本号                      |
|  7   |    cversion     |   long   |               节点的所拥有子节点被修改的版本号               |
|  8   |    aversion     |   long   |                   节点的ACL被修改的版本号                    |
|  9   | emphemeralOwner |   long   | 如果此节点为临时节点，那么它的值为这个节点拥有者的会话ID，否则为0 |
|  10  |   dataLength    |   int    |                       节点数据域的长度                       |
|  11  |   numChildren   |   int    |                     节点拥有的子节点个数                     |

`临时节点`：断开连接之后节点消失的称为临时节点

`持久节点`：断开连接之后节点不消失的称为持久节点

# 客户端常用命令

使用zkCli.sh  -server 127.0.0.1:2181连接到Zookeeper服务。

+ 显示根目录下文件：`ls /` 使用ls命令来查看当前zookeeper中所包含的内容
+ 显示根目录下文件：`ls2 / `查看当前节点数据并能看到更新次数等数据
+ 创建文件，并设置初始内容，`create /zk test `创建一个新的znode节点`zk`以及与它关联的字符串
+ 获取文件内容：`get /zk`确认znode是否包含我们所创建的字符串
+ 修改文件内容：`set /zk newTest`
+ 删除文件：`delete /zk`删除节点，如果存在子节点则删除失败
+ 递归删除：`rmr /zk`删除节点，存在子节点同时删除
+ 退出客户端：`quit`
+ 帮助命令：`help`
+ -e：临时节点
+ -s：顺序节点

